<!-- On ajoute ce contexte de sidenav pour éviter trop de régressions suite à la refonte du front -->
<mat-sidenav-container>
    <mat-sidenav-content>
        <div *ngIf="metadata" [ngClass]="{'metadata-container-sm': mediaSize.isSm  || mediaSize.isMd,
            'metadata-container-lg':  mediaSize.isLg, 'metadata-container-xl': mediaSize.isXl, 'metadata-container-xxl': mediaSize.isXxl}"
             class="metadata-container pl-0 pr-0 container-fluid">
            <!-- Icon et titre de la ressource -->
            <div class="header-metadata ml">
                <div class="header-img">
                    <app-organization-logo organizationType="producer"
                                           [organizationId]="metadata?.producer.organization_id"
                                           [cssClass]="mediaSize.isSm ? 'metadata-theme-sm' : 'metadata-theme'"></app-organization-logo>
                </div>
                <div class="header-ressource">
                    <span class="producer-name">{{metadata?.producer?.organization_name}}</span>
                    <h2 class="blue-theme">{{metadata?.resource_title}}</h2>
                </div>
            </div>
            <!-- Fin Icon et titre de la ressource -->

            <!-- Bandeau -->
            <div class="bandeau">
                <mat-toolbar class="bandeau-card">
                    <button [ngClass]="{'btn-info-xs': mediaSize.isXs}" class="button button-info" mat-raised-button
                            routerLink="/information" disabled>
                        <mat-icon svgIcon="icon-info"
                                  [ngClass]="mediaSize.isSm ? 'icon-information-sm' : 'icon-information'">error_outline
                        </mat-icon>
                        <span
                            [ngClass]="{'bandeau-icon-libelle': mediaSize.isSm}">{{'metaData.informations'|translate}}</span>
                    </button>
                    <button class="button ml-3" mat-raised-button routerLink="/donnees" style="display: none">
                        <mat-icon class="icon-syle">dns</mat-icon>
                        <span [ngClass]="{'bandeau-icon-libelle': mediaSize.isXs}">Données</span>
                    </button>
                    <span class="spacer"></span>
                    <button mat-raised-button *ngIf="downloadableMedias.length > 0"
                            [matMenuTriggerFor]="formatMenu"
                            #clickMenuFormatTrigger="matMenuTrigger"
                            class="button bandeau-btn-telecharger"
                    >
                        <mat-icon class="icon-syle icon-save mr-l">save_alt</mat-icon>
                        <span [ngClass]="{'bandeau-icon-libelle': mediaSize.isSm}">Télécharger</span>
                        <mat-menu #formatMenu="matMenu" xPosition="after" role="menu">
                            <div (click)="$event.stopPropagation()" class="rudi-select-panel" fxLayout="column">
                                <form [formGroup]="form">
                                    <h4 class="menu-libelle"
                                        tabindex="0">{{'availableFormats.formatsDisponibles'|translate}}</h4>

                                    <mat-radio-group #radioGroup="matRadioGroup" (click)="$event.stopPropagation()"
                                                     aria-label="Select an option"
                                                     formControlName="options" fxLayout="column">
                                        <mat-radio-button
                                            class="mb-2"
                                            *ngFor="let item of downloadableMedias; let i = index"
                                            [value]="item"
                                            [checked]="i === 0">
                                            {{getMediaFileExtension(item)}}
                                        </mat-radio-button>
                                    </mat-radio-group>

                                    <button
                                        (click)="onDownloadFormat()"
                                        [ngClass]="{'btn-telecharger-format':metadata.available_formats.length == null }"
                                        class="button menu-btn-telecharger"
                                        mat-raised-button
                                        tabindex="3"
                                        type="submit"
                                    >
                                        {{'availableFormats.telecharger'|translate}}</button>
                                </form>

                            </div>
                        </mat-menu>
                    </button>
                    <button class="button ml-3" mat-raised-button routerLink="/partager" [hidden]="true">
                        <mat-icon class="icon-syle">share</mat-icon>
                    </button>
                </mat-toolbar>
            </div>
            <a #a_export></a>

            <!-- Fin Bandeau -->

            <!-- Card Description  Theme Mot clés -->
            <div class="row mt-3 mb-4 px-80 card-description-keyword-row">
                <div [ngClass]="{'col-7': mediaSize.isMd,
                    'col-8':  mediaSize.isSm  || mediaSize.isLg || mediaSize.isXl || mediaSize.isXxl}"
                     class=" card-description-keyword">
                    <!--  Card Description -->
                    <div class="card-description mb-4">
                        <mat-card class="metadata-card">
                            <mat-card-title
                                class="card-label-title">{{'metaData.description'|translate}}</mat-card-title>
                            <mat-card-content class="mb-3 mt-3">
                                <span *ngIf="metadata.summary">{{getSummaryDescription(metadata)}}</span>
                            </mat-card-content>
                        </mat-card>
                    </div>

                    <!--  Card Theme et mot-clés -->
                    <div class="card-description">
                        <mat-card class="metadata-card">
                            <mat-card-title
                                class="card-label-title">{{'metaData.themeEtMotCle'|translate}}</mat-card-title>
                            <mat-card-content class="mt-3 pb-3">
                                <div class="d-flex d-table-cell keywords-row flex-wrap">
                                    <button
                                        *ngIf="themeLabel" [matTooltip]="themeLabel"
                                        class="rudi-btn-sm mb-2 rudi-btn-theme-detail"
                                        mat-flat-button
                                    >
                                        <mat-icon [svgIcon]="themePicto"></mat-icon>
                                        {{themeLabel | uppercase}}
                                    </button>
                                    <ng-container *ngIf="metadata.keywords.length > 0">
                                        <ng-container *ngFor="let keyword of metadata.keywords">
                                            <button class="rudi-btn-sm d-flex align-items-center mb-2"
                                                    mat-flat-button>{{ keyword }}</button>
                                        </ng-container>
                                    </ng-container>
                                </div>
                            </mat-card-content>
                        </mat-card>
                    </div>

                    <mat-card
                        [ngClass]="{'d-none': mediaSize.isMd ||mediaSize.isSm === true, 'meta-data-card-lg': mediaSize.isLg ||mediaSize.isXl || mediaSize.isXxl}"
                        class="meta-data-card">
                        <app-data-sets-infos
                            *ngIf="mediaSize.isDeviceDesktop"
                            [mediaSize]="mediaSize"
                            [metadata]="metadata"
                            [downloadableMedias]="downloadableMedias"
                        >
                        </app-data-sets-infos>
                    </mat-card>

                    <!-- Info File et Producteur en mode sm -->
                    <div class="card-producer-file-sm" *ngIf="mediaSize.isDeviceMobile">
                        <mat-card class="card-file metadata-card">
                            <div class="card-producer-file-sm-title">
                                <ng-container
                                    *ngIf="availableFormat(mediaDataType.Series) && !availableFormat(mediaDataType.File)">
                                    <mat-icon class="icon-file">timeline</mat-icon>
                                    <label class="card-label-title pl-3">{{'metaData.tempsReel'|translate}}</label>
                                </ng-container>

                                <ng-container
                                    *ngIf="availableFormat(mediaDataType.File) && !availableFormat(mediaDataType.Series)">
                                    <mat-icon class="icon-file">description</mat-icon>
                                    <label class="card-label-title pl-3">{{'metaData.fichier'|translate}}</label>
                                </ng-container>
                                <ng-container
                                    *ngIf="availableFormat(mediaDataType.File) && availableFormat(mediaDataType.Series)">
                                    <mat-icon class="icon-file">description</mat-icon>
                                    <label
                                        class="card-label-title pl-3">{{'metaData.fichier'|translate}} {{'common.et'|translate}}
                                        {{'metaData.tempsReel'|translate}}</label>
                                </ng-container>
                                <span class="file_status">{{metadata.storage_status}}</span>
                            </div>
                            <div [ngClass]="{'date-range-md': mediaSize.isMd}"
                                 class="date-range d-flex">
                                <div *ngIf="metadata.temporal_spread?.start_date" class="debutPeriode w-50 pr-5">
                                    <span
                                        class="display-block label-date">{{'datasetDate.debutDePeriode'|translate}}</span>
                                    <span
                                        class="date">{{metadata.temporal_spread.start_date | date :'dd/MM/yyyy' }}</span>
                                    <span
                                        class="date-range-hour ml-2">{{metadata.temporal_spread.start_date | date :'HH:mm' }}</span>
                                </div>

                                <div *ngIf="metadata.temporal_spread?.end_date" class="finPeriode">
                                    <span class="display-block label-date">
                                        {{'datasetDate.finDePeriode'|translate}}
                                    </span>
                                    <span class="date">{{metadata.temporal_spread.end_date | date :'dd/MM/yyyy'}}</span>
                                    <span
                                        class="date-range-hour ml-2">{{metadata.temporal_spread.end_date | date :'HH:mm'}}</span>
                                </div>
                            </div>

                            <div class="type-licence">
                                <span class="label-licence">{{'metaData.TypeLicence'|translate}}</span>
                                <span *ngIf="metadata?.access_condition?.licence.licence_type === licenceType.Standard"
                                      class="label-licence-status">
                                    <a href="{{this.conceptUri | async}}" target="_blank">{{licenceLabel | async}}</a>
                                </span>
                                <span *ngIf="metadata?.access_condition?.licence.licence_type === licenceType.Custom"
                                      class="label-licence-status">
                                    <a href="{{getCustomLicenceUri()}}"
                                       target="_blank">{{getCustomLicenceLabel(metadata.access_condition.licence)}}</a>
                                </span>
                            </div>

                            <div class="my-4 mr-auto">
                                <div *ngIf="metadata.dataset_dates.published" class="date-publication">
                                    <span
                                        class="label-date-publication">{{'datasetDate.dateDePublication'|translate}}</span>
                                    <span
                                        class="value-date-publication float-right">{{metadata?.dataset_dates.published | date :'dd/MM/yyyy'}}
                                        <span
                                            class="date-range-update-maj">{{metadata?.dataset_dates.published | date :'HH:mm' }}</span>
                                    </span>
                                </div>
                                <div *ngIf="metadata.dataset_dates.updated" class="date-mise-jour mt-3">
                                    <span class="label-date-publication">{{'datasetDate.miseAJour'|translate}}</span>
                                    <span
                                        class="value-date-publication float-right">{{metadata?.dataset_dates.updated | date :'dd/MM/yyyy'}}
                                        <span
                                            class="date-range-update-maj">{{metadata?.dataset_dates.updated | date :'HH:mm' }}</span>
                                    </span>
                                </div>
                            </div>
                        </mat-card>

                        <!-- Info Producteur pour taille md, sm, xs-->
                        <mat-card class="card-producteur metadata-card rudi-card-border">
                            <mat-card-title>
                                <h2 class="card-label-title">{{'metaData.producteur'|translate}}</h2>
                            </mat-card-title>
                            <div class="row ml-1">
                                <div class="mr-3 d-flex align-items-center producteur-img-box">
                                    <app-organization-logo organizationType="producer"
                                                           [organizationId]="metadata?.producer.organization_id"></app-organization-logo>
                                </div>

                                <div class="col-9 pl-0">
                                    <div class="producer-info pb-4">
                                <span
                                    *ngIf="metadata.producer.organization_name !== ''">{{metadata.producer.organization_name}}</span>
                                        <span
                                            *ngIf="metadata.producer.organization_address !== '' ">{{metadata.producer.organization_address}}</span>
                                    </div>
                                    <mat-divider></mat-divider>
                                    <div *ngIf="metadata.contacts && metadata.contacts.length > 0"
                                         class="pt-4">
                                        <div *ngFor="let data of metadata?.contacts"
                                             class="producer-info pb-3">
                                            <span>{{data.organization_name}}</span>
                                            <span>{{data.contact_name}}</span>
                                            <span>{{data.role}}</span>
                                            <span class="text-underline">{{data.email}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </mat-card>


                        <!-- Informations complémentaires -->
                        <mat-card
                            [ngClass]="{'meta-data-card-sm': mediaSize.isMd ||mediaSize.isSm === true, 'meta-data-card-lg': mediaSize.isLg ||mediaSize.isXl || mediaSize.isXxl}"
                            class="meta-data-card mb-5">
                            <app-data-sets-infos
                                [mediaSize]="mediaSize"
                                [metadata]="metadata"
                                [downloadableMedias]="downloadableMedias"
                            >
                            </app-data-sets-infos>
                        </mat-card>
                    </div>
                </div>

                <div [ngClass]="{'col-5': mediaSize.isMd,
                    'col-4':  mediaSize.isSm  || mediaSize.isLg || mediaSize.isXl || mediaSize.isXxl}"
                     class="card-producer-file">
                    <mat-card class="card-file metadata-card pb-4">
                        <div class="card-producer-file-title">
                            <ng-container
                                *ngIf="availableFormat(mediaDataType.Series) && !availableFormat(mediaDataType.File)">
                                <mat-icon class="icon-file">timeline</mat-icon>
                                <label class="card-label-title pl-3">{{'metaData.tempsReel'|translate}}</label>
                            </ng-container>

                            <ng-container
                                *ngIf="availableFormat(mediaDataType.File) && !availableFormat(mediaDataType.Series)">
                                <mat-icon class="icon-file">description</mat-icon>
                                <label class="card-label-title pl-3">{{'metaData.fichier'|translate}}</label>
                            </ng-container>
                            <ng-container
                                *ngIf="availableFormat(mediaDataType.File) && availableFormat(mediaDataType.Series)">
                                <mat-icon class="icon-file">description</mat-icon>
                                <label
                                    class="card-label-title pl-3">{{'metaData.fichier'|translate}} {{'common.et'|translate}}
                                    {{'metaData.tempsReel'|translate}}</label>
                            </ng-container>
                            <span class="file_status">{{metadata.storage_status}}</span>
                        </div>

                        <div *ngIf="metadata.temporal_spread" class="date-range">
                            <div *ngIf="metadata.temporal_spread?.start_date"
                                 class="debutPeriode"
                                 [ngClass]="{'right-vertical-separator': metadata.temporal_spread?.end_date}">
                                <span class="display-block label-date">{{'datasetDate.debutDePeriode'|translate}}</span>
                                <span class="date">{{metadata.temporal_spread.start_date | date :'dd/MM/yyyy' }}
                                    <span
                                        class="date-range-hour mr-2">{{metadata.temporal_spread.start_date | date :'HH:mm' }}
                            </span>
                        </span>
                            </div>

                            <div *ngIf="metadata.temporal_spread?.end_date"
                                 class="finPeriode pl-2">
                                <span class="display-block label-date">{{'datasetDate.finDePeriode'|translate}}</span>
                                <span class="date">{{metadata.temporal_spread.end_date | date :'dd/MM/yyyy'}}
                                    <span
                                        class="date-range-hour ">{{metadata.temporal_spread.end_date | date :'HH:mm' }}
                            </span>
                        </span>
                            </div>
                        </div>
                        <div class="type-licence">
                            <span class="label-licence">{{'metaData.TypeLicence'|translate}}</span>
                            <span *ngIf="metadata?.access_condition?.licence.licence_type === licenceType.Standard"
                                  class="label-licence-status">
                                <a href="{{this.conceptUri | async}}" target="_blank">{{licenceLabel | async}}</a>
                            </span>
                            <span *ngIf="metadata?.access_condition?.licence.licence_type === licenceType.Custom"
                                  class="label-licence-status">
                                <a href="{{getCustomLicenceUri()}}"
                                   target="_blank">{{getCustomLicenceLabel(metadata.access_condition.licence)}}</a>
                            </span>
                        </div>

                        <div class="mt-4 mr-auto">
                            <div *ngIf="metadata.dataset_dates.published" class="date-publication">
                                <span
                                    class="label-date-publication">{{'datasetDate.dateDePublication'|translate}}</span>
                                <span
                                    class="value-date-publication float-right">{{metadata?.dataset_dates.published | date :'dd/MM/yyyy'}}
                                    <span
                                        class="date-range-update-maj">{{metadata?.dataset_dates.published | date :'HH:mm' }}</span>
                                </span>
                            </div>
                            <div *ngIf="metadata.dataset_dates.updated" class="date-mise-jour mt-3">
                                <span class="label-date-publication">{{'datasetDate.miseAJour'|translate}}</span>
                                <span
                                    class="value-date-publication float-right">{{metadata?.dataset_dates.updated | date :'dd/MM/yyyy'}}
                                    <span
                                        class="date-range-update-maj">{{metadata?.dataset_dates.updated | date :'HH:mm' }}</span>
                                </span>
                            </div>
                        </div>

                    </mat-card>

                    <!-- Info Producteur pour taille lg, xl, xxl-->
                    <mat-card class="card-producteur metadata-card rudi-card-border">
                        <mat-card-title>
                            <h2 class="card-label-title">{{'metaData.producteur'|translate}}</h2>
                        </mat-card-title>
                        <div class="row">
                            <div class="d-flex align-items-center producteur-img-box">
                                <app-organization-logo organizationType="producer"
                                                       [organizationId]="metadata?.producer.organization_id"
                                                       cssClass="producteur-img"></app-organization-logo>
                            </div>

                            <div [ngClass]="{'col-8': mediaSize.isLg, 'col-9': mediaSize.isXl || mediaSize.isXxl}">
                                <div class="producer-info pb-4">
                                    <span
                                        *ngIf="metadata.producer.organization_name">{{metadata.producer.organization_name | uppercase}}</span>
                                    <span
                                        *ngIf="metadata.producer.organization_address">{{metadata.producer.organization_address}}</span>
                                </div>
                                <mat-divider></mat-divider>
                                <div *ngIf="metadata.contacts && metadata.contacts.length > 0"
                                     class="pt-4">
                                    <div *ngFor="let data of metadata?.contacts"
                                         class="producer-info pb-3">
                                        <span>{{data.organization_name}}</span>
                                        <span>{{data.contact_name}}</span>
                                        <span>{{data.role}}</span>
                                        <span class="text-underline">{{data.email}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </mat-card>
                </div>
            </div>
        </div>
    </mat-sidenav-content>
</mat-sidenav-container>
