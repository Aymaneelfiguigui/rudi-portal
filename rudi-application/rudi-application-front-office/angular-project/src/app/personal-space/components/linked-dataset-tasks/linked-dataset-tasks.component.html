<app-loader
    [active]="searchIsRunning">
</app-loader>

<app-search-count
    [searchIsRunning]="searchIsRunning"
    [count]="requestsToStudy?.length"
    [noResultMessage]="'personalSpace.receivedAccessRequests.noResult' | translate">
</app-search-count>

<!-- On utilise hidden à la place de *ngIf pour éviter des bugs avec mat-table : https://stackoverflow.com/a/56127490/1655155 -->
<div [hidden]="!(requestsToStudy?.length)">

    <table mat-table [dataSource]="dataSource" matSort matSortActive="receivedDate" matSortDirection="desc" class="cursor">

        <ng-container matColumnDef="receivedDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header scope="col">{{'personalSpace.receivedAccessRequests.receivedDate'|translate}}</th>
            <td mat-cell *matCellDef="let requestToStudy"> {{requestToStudy.receivedDate | date: 'dd/MM/YYYY'}} </td>
        </ng-container>

        <ng-container matColumnDef="datasetTitle">
            <th mat-header-cell *matHeaderCellDef mat-sort-header scope="col">
                <mat-icon [svgIcon]="restrictedDatasetIcon"></mat-icon>
                {{'personalSpace.receivedAccessRequests.datasetTitle'|translate}}
            </th>
            <td mat-cell *matCellDef="let requestToStudy" class="dataset-title"> {{requestToStudy.datasetTitle}} </td>
        </ng-container>

        <ng-container matColumnDef="ownerName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header scope="col">{{'personalSpace.receivedAccessRequests.ownerName'|translate}}</th>
            <td mat-cell *matCellDef="let requestToStudy" class="owner-name"> {{requestToStudy.ownerName}} </td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header scope="col">{{'personalSpace.receivedAccessRequests.status'|translate}}</th>
            <td mat-cell *matCellDef="let requestToStudy"> <span class="status-chip">{{requestToStudy.status}}</span> </td>
        </ng-container>

        <ng-container matColumnDef="endDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header scope="col">{{'personalSpace.receivedAccessRequests.endDate'|translate}}</th>
            <td mat-cell *matCellDef="let requestToStudy"> {{requestToStudy.endDate ? (requestToStudy.endDate | date: 'dd/MM/YYYY') : '–'}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="requestsToStudyDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let request; columns: requestsToStudyDisplayedColumns;" [routerLink]="['..', 'request-detail', request.taskId]"></tr>
    </table>

    <app-paginator [pageSize]="10"></app-paginator>

</div>
